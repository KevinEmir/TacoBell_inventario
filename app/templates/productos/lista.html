{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3">Lista de Productos</h1>
  <a href="{{ url_for('productos.crear') }}" class="btn btn-primary">
    ➕ Nuevo Producto
  </a>
</div>

<!-- Formulario de búsqueda -->
<form method="get" class="mb-3">
  <div class="input-group">
    <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Buscar producto...">
    <button class="btn btn-outline-secondary" type="submit">Buscar</button>
  </div>
</form>

<!-- Tabla de productos -->
<div class="card">
  <div class="card-body">
    {% if productos %}
      <table class="table table-striped table-hover align-middle">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Categoría</th>
            <th>Proveedor</th>
            <th>Stock</th>
            <th>Unidad</th>
            <th>Precio Unitario</th>
            <th>Activo</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for p in productos %}
          <tr>
            <td>{{ p.Nombre }}</td>
            <td>{{ p.categoria.Nombre }}</td>
            <td>{{ p.proveedor.Nombre }}</td>
            <td>{{ p.CantidadActual }}</td>
            <td>{{ p.UnidadMedida }}</td>
            <td>₡{{ "%.2f"|format(p.PrecioUnitario or 0) }}</td>
            <td>
              {% if p.Activo %}
                <span class="badge bg-success">Activo</span>
              {% else %}
                <span class="badge bg-secondary">Inactivo</span>
              {% endif %}
            </td>
            <td class="text-end">
              <a href="{{ url_for('productos.editar', id=p.Id) }}" class="btn btn-sm btn-warning">Editar</a>
              <form action="{{ url_for('productos.eliminar', id=p.Id) }}" method="post" class="d-inline">
                <button type="submit" class="btn btn-sm btn-danger"
                        onclick="return confirm('¿Seguro que deseas desactivar este producto?')">
                  Eliminar
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted text-center mb-0">No hay productos registrados.</p>
    {% endif %}
  </div>
</div>

{% endblock %}
