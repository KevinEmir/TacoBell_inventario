{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
</div>

  <h1 class="h3">Lista de Productos</h1>
  <a href="{{ url_for('productos.crear') }}" class="btn btn-primary">
    ‚ûï Nuevo Producto
  </a>
</div>

<!-- Formulario de b√∫squeda -->
<form method="GET" class="row mb-3 align-items-end">
    <div class="col-md-3">
        <label for="q" class="form-label">Nombre</label>
        <input type="text" id="q" name="q" class="form-control" placeholder="Buscar producto" value="{{ q }}">
    </div>

    <div class="col-md-3">
        <label for="categoria" class="form-label">Categor√≠a</label>
        <select id="categoria" name="categoria" class="form-select">
            <option value="">-- Todas --</option>
            {% for c in categorias %}
            <option value="{{ c.Id }}" {% if categoria_id == c.Id %}selected{% endif %}>{{ c.Nombre }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-3">
        <label for="proveedor" class="form-label">Proveedor</label>
        <select id="proveedor" name="proveedor" class="form-select">
            <option value="">-- Todos --</option>
            {% for p in proveedores %}
            <option value="{{ p.Id }}" {% if proveedor_id == p.Id %}selected{% endif %}>{{ p.nombre }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-2">
        <label for="activo" class="form-label">Estado</label>
        <select id="activo" name="activo" class="form-select">
            <option value="">-- Todos --</option>
            <option value="1" {% if activo == '1' %}selected{% endif %}>Activo</option>
            <option value="0" {% if activo == '0' %}selected{% endif %}>Inactivo</option>
        </select>
    </div>

    <div class="col-md-1 text-end">
        <button type="submit" class="btn btn-primary w-100 shadow-sm">
          üîç Buscar
        </button>

    </div>
</form>

{% if q or categoria_id or proveedor_id or activo %}
<div class="mb-3 text-end">
    <a href="{{ url_for('productos.lista') }}" class="btn btn-secondary btn-sm">Limpiar filtros</a>
</div>
{% endif %}


<!-- Tabla de productos -->
<div class="card">
  <div class="card-body">
    {% if productos %}
      <table class="table modern-table align-middle mb-0">
  <thead>
    <tr>
      <th>Producto</th>
      <th>Categor√≠a</th>
      <th>Proveedor</th>
      <th>Stock</th>
      <th>Unidad</th>
      <th>Precio</th>
      <th>Estado</th>
      <th class="text-end">Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for p in productos %}
    <tr>
      <td>
        <strong class="text-dark">{{ p.Nombre }}</strong>
        {% if not p.Activo %}
          <span class="badge bg-secondary ms-2">Inactivo</span>
        {% endif %}
      </td>
      <td>
        {% if p.categoria %}
          <span class="badge bg-light text-dark border">{{ p.categoria.Nombre }}</span>
        {% else %}
          <span class="text-muted">-</span>
        {% endif %}
      </td>
      <td>
        {% if p.proveedor %}
          <span class="badge bg-soft-accent">{{ p.proveedor.nombre }}</span>
        {% else %}
          <span class="text-muted">-</span>
        {% endif %}
      </td>
      <td><span class="fw-semibold">{{ p.CantidadActual }}</span></td>
      <td>{{ p.UnidadMedida }}</td>
      <td>‚Ç°{{ "%.2f"|format(p.PrecioUnitario or 0) }}</td>
      <td>
        {% if p.Activo %}
          <span class="status-dot bg-success"></span> Activo
        {% else %}
          <span class="status-dot bg-danger"></span> Inactivo
        {% endif %}
      </td>
      <td class="text-end">
        <a href="{{ url_for('productos.editar', id=p.Id) }}" 
           class="btn btn-sm btn-outline-warning shadow-sm me-1">
           Editar
        </a>
        <form action="{{ url_for('productos.eliminar', id=p.Id) }}" method="post" class="d-inline">
          <button type="submit" class="btn btn-sm btn-outline-danger shadow-sm"
                  onclick="return confirm('¬øSeguro que deseas desactivar este producto?')">
            Eliminar
          </button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

    {% else %}
      <p class="text-muted text-center mb-0">No hay productos registrados.</p>
    {% endif %}
  </div>
</div>

{% endblock %}
