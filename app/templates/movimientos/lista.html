{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>Movimientos</h2>

  <!-- 🔍 FILTRO -->
  <form method="GET" class="row g-3 align-items-end mb-3">
    <div class="col-md-4">
      <label for="q" class="form-label">Buscar por producto</label>
      <input type="text" id="q" name="q" class="form-control" placeholder="Ejemplo: Coca-Cola"
             value="{{ q }}">
    </div>

    <div class="col-md-3">
      <label for="tipo" class="form-label">Tipo de movimiento</label>
      <select id="tipo" name="tipo" class="form-select">
        <option value="">-- Todos --</option>
        <option value="entrada" {% if tipo == 'entrada' %}selected{% endif %}>Entradas</option>
        <option value="salida" {% if tipo == 'salida' %}selected{% endif %}>Salidas</option>
      </select>
    </div>

    <div class="col-md-3 text-end">
      <button type="submit" class="btn btn-primary w-100">Filtrar</button>
    </div>
  </form>

  {% if q or tipo %}
  <div class="mb-3 text-end">
    <a href="{{ url_for('movimientos.lista') }}" class="btn btn-secondary btn-sm">Limpiar filtros</a>
  </div>
  {% endif %}

  <!-- 🆕 BOTÓN NUEVO MOVIMIENTO -->
  <a href="{{ url_for('movimientos.crear') }}" class="btn btn-success mb-3">Nuevo Movimiento</a>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Producto</th>
        <th>Tipo</th>
        <th>Cantidad</th>
        <th>Fecha</th>
        <th>Motivo</th>
        <th>Notas</th>
      </tr>
    </thead>
    <tbody>
      {% for m in movimientos %}
      <tr>
        <td>{{ m.Id }}</td>
        <td>{{ m.producto.Nombre if m.producto else '-' }}</td>
        <td>{{ m.Tipo }}</td>
        <td>{{ m.Cantidad }}</td>
        <td>{{ m.FechaCreacion.strftime('%Y-%m-%d %H:%M') if m.FechaCreacion else '' }}</td>
        <td>{{ m.Motivo or '' }}</td>
        <td>{{ m.Notas or '' }}</td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7" class="text-center">No hay movimientos.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
